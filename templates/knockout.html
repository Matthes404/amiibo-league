{% extends 'base.html' %}
{% block content %}
<h1>Knockout Brackets</h1>
{% for key, data in brackets.items() %}
  <h2>Bracket {{ key }}</h2>
  <div class="ko-bracket">
    {% for round in data.rounds %}
      {% if round %}
      <div class="round">
        {% for pair in round %}
        <div class="pair{% if pair.highlight %} winner-path{% endif %}">
          {% for m in pair.matches %}
            {% if m %}
            <div class="match{% if m[3] %} winner-path{% endif %}">
              {% set p1_class = '' %}
              {% set p2_class = '' %}
              {% if m[2] and m[2] != 'Draw' %}
                {% if m[2].id == m[0].id %}
                  {% set p1_class = ' winner' %}
                  {% set p2_class = ' loser' %}
                  {% if m[3] %}
                    {% set p1_class = p1_class + ' champion' %}
                  {% endif %}
                {% else %}
                  {% set p1_class = ' loser' %}
                  {% set p2_class = ' winner' %}
                  {% if m[3] %}
                    {% set p2_class = p2_class + ' champion' %}
                  {% endif %}
                {% endif %}
              {% endif %}
              <div class="player{{ p1_class }}">{{ m[0].name }}</div>
              <div class="player{{ p2_class }}">{{ m[1].name }}</div>
              <div class="result">
                {% if not m[2] %}
                  <form method="post" action="/report_knockout_result">
                    <input type="hidden" name="bracket" value="{{ key }}">
                    <input type="hidden" name="player1" value="{{ m[0].id }}">
                    <input type="hidden" name="player2" value="{{ m[1].id }}">
                    <input type="number" name="score1" min="0" required>
                    <input type="number" name="score2" min="0" required>
                    <button type="submit">Submit</button>
                  </form>
                {% elif m[2] == 'Draw' %}
                  Draw
                {% endif %}
              </div>
            </div>
            {% endif %}
          {% endfor %}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    {% endfor %}
  </div>
{% endfor %}
{% endblock %}
